{% extends 'groth16/base-groth16.html' %}

{% block content_in %}
<h2>Verifying</h2>
<section>
    <h4>1.Proofs and public Rx from prover</h4>
    {% if proofs == [] %}
    {% else %}
        <p>
            <ul>
            <li>proof_a : [{{snl(proofs[0].proof_a)}}]</li>
            <li>
                proof_b : 
                [{% for b in proofs[0].proof_b %} 
                    [{{snl(b)}}]
                {% endfor %}]
            </li> 
            <li>proof_c : [{{snl(proofs[0].proof_c)}}]</li> 
            <li>public Rx : {{public_gates}}</li>
            </ul>
        </p>
    {% endif %}
</section>
<section>
    <h4>2.Verify</h4>
    <p>
        <button id="verifyButton" onclick="verifyGroth()" class="btn btn-primary">Verify</button>
    </p>
    <p>
        <table class="table table-bordered">
            <thead>
            <tr>
                <th scope="col">Index</th>
                <th scope="col">Formula</th>
                <th scope="col">Value</th>
            </tr>
            </thead>
            <tbody>
                <!-- LHS -->
                <tr>
                    <th scope="row">LHS(left hand side)</th>
                    <td>
                        LHS fomula
                    </td>
                    <td id="lhsValue"></td>
                </tr>

                <!-- RHS -->
                <tr>
                    <th scope="row">RHS(right hand side)</th>
                    <td>
                        RHS fomula
                    </td>
                    <td id="rhsValue"></td>
                </tr>
            </tbody>
        </table>
    </p>
    <p id="processingMessage" style="display: none;">Processing...</p>
    <p id="verificationStatus"></p>
</section>

<script>
    function verifyGroth() {
        const button = document.getElementById('verifyButton');
        const processingMessage = document.getElementById('processingMessage');
        const verificationStatus = document.getElementById('verificationStatus');

        verificationStatus.textContent = '';

        button.disabled = true;
        processingMessage.style.display = 'block';

        fetch("{{ url_for('groth_verify') }}", {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
        })
        .then(response => response.json())
        .then(data => {
            processingMessage.style.display = 'none';

            document.getElementById('lhsValue').textContent = data.lhs;
            document.getElementById('rhsValue').textContent = data.rhs;
            document.getElementById('verificationStatus').textContent = `Is LHS == RHS ? ${data.result}`;
        })
        .catch(error => {
            console.error('Error:', error);
            alert('An error occurred during verification.');
        })
        .finally(() => {
            button.disabled = false;
            processingMessage.style.display = 'none';
        });
    }
    </script>
{% endblock %}